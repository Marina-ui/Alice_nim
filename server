from flask import Flask, request
import json

app = Flask(__name__)


storage = {}


@app.route('/', methods=['POST'])
def main():
    req = request.json
    user_id = req["session"]["user_id"]

    if req["session"]["new"]:
        storage[user_id] = {'victories': 0, 'defeats': 0}   #можно будет подвести итог всем играм
        return generate_response(req, "Поажлуйста, выберите режим из списка: Обучение, Игра с Алисой.")

    context = storage[user_id]   #ведется счёт
    answer = req["request"]["original_utterance"].lower()

    if answer not in {'обучение', 'игра с алисой'}:
        return generate_response(req, "Необходимо выбрать режим из списка.")

    if answer == 'обучение':
        #запускается сценарий обучения
        pass
    elif answer == 'игра с алисой':
        #аналогично сценарий игры с Алисой
        result = ''

    #return generate_response(req, result, end_session=True)


def generate_response(req, text, end_session=False):
    res = {
        "version": req["version"],
        "session": req["session"],
        "response": {
            "end_session": end_session,
            "text": text
        }
    }
    return json.dumps(res, indent=2)


if __name__ == '__main__':
    app.run('0.0.0.0', 8080)
